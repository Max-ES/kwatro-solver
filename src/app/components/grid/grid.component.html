<div class="grid" [ngClass]="{'invalid': invalid}">
  <div *ngFor="let row of grid; let i = index" class="row">
    <div
      *ngFor="let field of row; let j = index"
      class="field"
      [ngClass]="{ highlight: isHighlighted(i, j) }"
      #menuTrigger="matMenuTrigger"
      [matMenuTriggerFor]="menu"
      (menuOpened)="menuOpened(i,j, menuTrigger)"
      (menuClosed)="newField.emit()"
    >
      <mat-menu #menu="matMenu">
        <div
          class="menu-content"
          *ngIf="field !== null"
          (click)="$event.stopPropagation();"
        >
          <mat-radio-group class="my-radio-group" [(ngModel)]="field![0]">
            <mat-radio-button
              *ngFor="let color of colorValues; let c = index"
              [value]="c + 1"
              >{{ color }}</mat-radio-button
            >
          </mat-radio-group>

          <mat-radio-group class="my-radio-group" [(ngModel)]="field![1]">
            <mat-radio-button
              *ngFor="let shape of shapeValues; let s = index"
              [value]="s + 1"
              >{{ shape }}</mat-radio-button
            >
          </mat-radio-group>

          <mat-radio-group class="my-radio-group" [(ngModel)]="field![2]">
            <mat-radio-button
              *ngFor="let number of [1, 2, 3, 4]"
              [value]="number"
              >{{ number }}</mat-radio-button
            >
          </mat-radio-group>
          <button mat-icon-button (click)="delete(i, j)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </mat-menu>

      <div *ngIf="field !== null" [ngSwitch]="field[1]">
        <div class="number">{{ field[2] }}</div>
        <div *ngSwitchCase="shapes.Circle">
          <svg height="60" width="60" class="shape">
            <circle
              cx="30"
              cy="30"
              r="29"
              stroke="black"
              stroke-width="1"
              [attr.fill]="getColor(field)"
            />
          </svg>
        </div>
        <div *ngSwitchCase="shapes.Cross">
          <svg height="60" width="60" class="shape">
            <rect
              x="0"
              y="20"
              width="60"
              height="20"
              [attr.fill]="getColor(field)"
            />
            <rect
              x="20"
              y="0"
              width="20"
              height="60"
              [attr.fill]="getColor(field)"
            />
          </svg>
        </div>
        <div *ngSwitchCase="shapes.Rectangle">
          <svg height="60" width="60" class="shape">
            <rect
              x="0"
              y="0"
              width="60"
              height="60"
              stroke="black"
              stroke-width="1"
              [attr.fill]="getColor(field)"
            />
          </svg>
        </div>
        <div *ngSwitchCase="shapes.Triangle">
          <svg height="60" width="60" class="shape">
            <polygon
              points="30,5 60,55 0,55"
              stroke="black"
              stroke-width="1"
              [attr.fill]="getColor(field)"
            />
          </svg>
        </div>
      </div>
    </div>
  </div>
</div>
